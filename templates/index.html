<!DOCTYPE html>

<head>
    <title>Polling</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/9.7.3/bootstrap-slider.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/9.7.3/bootstrap-slider.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/9.7.3/css/bootstrap-slider.min.css"
          integrity="sha256-dXHafC+HTlEpRnrt+UjknVf5gRji+RofwsBhGpJ43NA=" crossorigin="anonymous"/>

</head>
<script src="http://d3js.org/d3.v3.min.js"></script>

<style>


    .header {
        padding-bottom: 1.25rem;
        margin-bottom: 2rem;
        border-bottom: .05rem solid #eee;
        background-color: #ADC7E8;

    }

    .item_name {
        font-size: 18px;
    }

    .chart {
        margin-bottom: 2rem;
        border-bottom: .05rem solid #eee;
    }

    .chart .legend {
        fill: black;
        font: 14px sans-serif;
        text-anchor: start;
        font-size: 12px;
    }

    #Slider .slider-selection {
        background: #ADC7E8;

    }

    .slider_box {
        margin-bottom: 2rem;
    }

    .left {
        position: fixed;
    }

    h3 {
        margin-bottom: 7rem;
    }

    #result_chart {
        margin-bottom: 7rem;
    }

    .balance_list {
        margin-bottom: 3rem;
    }

    .bar:hover {
        fill: grey;
    }

</style>

<body>
<div class="test"></div>
<div class="header">
    <div class="container">
        <div class="row">
            <div>
                <h1>Polling Balance</h1>
                <p>Explore Interesting Fact Behind Election Prediction</p>
            </div>
        </div>
    </div>
</div>
<div class=container>
    <div class="btn-group">
        <button class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown">Choose a Polling Data
            <span class="caret"></span></button>
        <ul class="dropdown-menu">
            <li><a class="survey_datasource" value="MUP48"> Sep 2012</a></li>
            <li><a class="survey_datasource" value="MUP126"> Aug 2016</a></li>
        </ul>
    </div>
    <div class="btn-group">
        <button class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown">Choose a Baseline
            Population
            <span class="caret"></span></button>
        <ul class="dropdown-menu">
            <li><a class="baseline_datasource" value="All_Adults">All Adults</a></li>
            <li><a class="baseline_datasource" value="All_Voters">All Voters</a></li>
        </ul>
    </div>
</div>

<div class=container>
    <div class="row">
        <div class="col-sm-6">
            <!-- main view -->
            <div id="result">
                <h3>Who will win the votes?</h3>
                <svg id="result_chart"></svg>
            </div>

            <div class="balance_list">
                <b>Balance by:</b><span class="balance_by"/>
            </div>

            <!-- slider -->
            <div class="slider_box">
                <span>0%&nbsp;&nbsp;</span>
                <input id="ex1" data-slider-id='Slider' type="text" data-slider-min="0" data-slider-max="100"
                       data-slider-step="1" data-slider-value="14"/>
                <span>&nbsp;&nbsp;100%</span>
            </div>
        </div>
        <!-- attributes -->
        <div class="col-sm-6">
            <div class="chart" id="edu_level">
                <p class="item_name"><input type="checkbox" class="check_box" value="Last Grade in School"/>&nbsp;&nbsp;Last
                    Grade in School:</p>
                <svg id="edu_level_chart"></svg>

            </div>
            <div class="chart" id="gender">
                <p class="item_name"><input type="checkbox" class="check_box" value="Gender"/>&nbsp;&nbsp;Gender:</p>
                <svg id="gender_chart"></svg>
            </div>
            <div class="chart" id="age">
                <p class="item_name"><input type="checkbox" class="check_box" value="Age"/>&nbsp;&nbsp;Age:</p>
                <svg id="age_chart"></svg>
            </div>
            <div class="chart" id="state">
                <p class="item_name"><input type="checkbox" class="check_box" value="State"/>&nbsp;&nbsp;State:</p>
                <svg id="state_chart"></svg>
            </div>
            <div class="chart" id="hispanic">
                <p class="item_name"><input type="checkbox" class="check_box" value="Latino or Hispanic Oringin"/>&nbsp;&nbsp;Latino
                    or Hispanic Oringin:</p>
                <svg id="hispanic_chart"></svg>
            </div>
            <div class="chart" id="race">
                <p class="item_name"><input type="checkbox" class="check_box" value="Race"/>&nbsp;&nbsp;Race:</p>
                <svg id="race_chart"></svg>
            </div>
            <div class="chart" id="party">
                <p class="item_name"><input type="checkbox" class="check_box" value="Party"/>&nbsp;&nbsp;Party:</p>
                <svg id="party_chart"></svg>
            </div>
            <div class="chart" id="income">
                <p class="item_name"><input type="checkbox" class="check_box" value="Annual Family Income"/>&nbsp;&nbsp;Annual
                    Family Income(MUP126 2016):</p>
                <svg id="income_chart"></svg>
            </div>
            <div class="chart" id="political_view">
                <p class="item_name"><input type="checkbox" class="check_box" value="Political View"/>&nbsp;&nbsp;Political
                    View(MUP126 2016):</p>
                <svg id="political_view_chart"></svg>
            </div>
        </div>
    </div>
</div>
<script>
    // Slider
    $('#ex1').slider({
        formatter: function (value) {
            return value + '%';
        }
    });

    //check box
    $(document).ready(function () {
        $(".check_box").change(function () {
            if (this.checked) {
                // the checkbox is now checked
                $(".balance_by").append($(this).attr("value") + ", ");
            }
            else {
                // the checkbox is now unchecked
                var todelete = $(this).attr("value") + ", ";
                $(".balance_by").text(function (i, txt) {
                    return txt.replace(todelete, '');
                });
            }
        });
    });
</script>


<script>


    var chartWidth = 200,
        barHeight = 15,
        groupHeight = barHeight * 2,
        gapBetweenGroups = 8,
        spaceForLabels = 180,
        spaceForLegend = 200;
    var edu_data, edu_x, gender_data, gender_x, hispanic_data, hispanic_x, race_data, race_x, income_data, income_x,
        political_view_data, political_view_x, party_data, party_x;


    $(document).ready(function () {
        //draw survey data
        $(".survey_datasource").click(function () {
            $.post('/requestdata', {name: $(this).attr('value')}, function (data) {
                //edu chart
                var edu_labels = data["last_grade_in_school"]["labels"];
                edu_data = data["last_grade_in_school"]["values"];
                var educhartHeight = barHeight * edu_data.length * 2 + gapBetweenGroups * edu_labels.length;
                edu_x = d3.scale.linear()
                    .domain([0, d3.max(edu_data)])
                    .range([0, chartWidth]);

                // Specify the chart area and dimensions
                var educhart = d3.select("#edu_level_chart")
                    .attr("width", spaceForLabels + chartWidth + spaceForLegend)
                    .attr("height", educhartHeight);

                // Create bars, bars contains text label on the left, rect in the middle and number labels on the right
                var edu_bar = educhart.selectAll("g")
                    .data(edu_data)
                    .enter().append("g")
                    .attr("transform", function (d, i) {
                        //left offset and upper offset
                        return "translate(" + spaceForLabels + "," + (i * groupHeight + gapBetweenGroups * (0.5 + i)  ) + ")";
                    });

                // Create rectangles of the correct width
                edu_bar.append("rect")
                    .attr("fill", "#1f77b4")
                    .attr("class", "bar")
                    .attr("width", edu_x)
                    .attr("height", barHeight - 1);

                // Add number label on the right
                edu_bar.append("text")
                    .attr("class", "numlabel")
                    .attr("x", function (d) {
                        return edu_x(d) + 3;
                    })
                    .attr("y", barHeight / 2)
                    .attr("fill", "grey")
                    .attr("dy", ".35em")
                    .style("font", "10px sans-serif")
                    .text(function (d) {
                        return d + "%";
                    });

                // Draw labels on the left
                edu_bar.append("text")
                    .attr("class", "label")
                    .attr("x", function (d) {
                        return -10;
                    })
                    .attr("y", groupHeight / 2)
                    .attr("dy", "-.15em")
                    .style("text-anchor", "end")
                    .style("font", "14px sans-serif")
                    .text(function (d, i) {
                        return edu_labels[i];
                    });

                //gender chart
                var gender_labels = data["gender"]["labels"];
                 gender_data = data["gender"]["values"];
                var genderchartHeight = barHeight * gender_data.length * 2 + gapBetweenGroups * gender_labels.length;
                 gender_x = d3.scale.linear()
                    .domain([0, d3.max(gender_data)])
                    .range([0, chartWidth]);

                // Specify the chart area and dimensions
                var genderchart = d3.select("#gender_chart")
                    .attr("width", spaceForLabels + chartWidth + spaceForLegend)
                    .attr("height", genderchartHeight);

                // Create bars, bars contains text label on the left, rect in the middle and number labels on the right
                var bar = genderchart.selectAll("g")
                    .data(gender_data)
                    .enter().append("g")
                    .attr("transform", function (d, i) {
                        return "translate(" + spaceForLabels + "," + (i * groupHeight + gapBetweenGroups * (0.5 + i)  ) + ")";
                    });

                // Create rectangles of the correct width
                bar.append("rect")
                    .attr("fill", "#1f77b4")
                    .attr("class", "bar")
                    .attr("width", gender_x)
                    .attr("height", barHeight - 1);

                // Add number label on the right
                bar.append("text")
                    .attr("class", "numlabel")
                    .attr("x", function (d) {
                        return gender_x(d) + 3;
                    })
                    .attr("y", barHeight / 2)
                    .attr("fill", "grey")
                    .attr("dy", ".35em")
                    .style("font", "10px sans-serif")
                    .text(function (d) {
                        return d + "%";
                    });

                // Draw labels
                bar.append("text")
                    .attr("class", "label")
                    .attr("x", function (d) {
                        return -10;
                    })
                    .attr("y", groupHeight / 2)
                    .attr("dy", "-.15em")
                    .style("text-anchor", "end")
                    .style("font", "14px sans-serif")
                    .text(function (d, i) {
                        return gender_labels[i];
                    });

                //hispanic chart
                var hispanic_labels = data["hispanic_origin"]["labels"];
                hispanic_data = data["hispanic_origin"]["values"];
                var hispanicchartHeight = barHeight * hispanic_data.length * 2 + gapBetweenGroups * hispanic_labels.length;
                hispanic_x = d3.scale.linear()
                    .domain([0, d3.max(hispanic_data)])
                    .range([0, chartWidth]);

                // Specify the chart area and dimensions
                var hispanicchart = d3.select("#hispanic_chart")
                    .attr("width", spaceForLabels + chartWidth + spaceForLegend)
                    .attr("height", hispanicchartHeight);

                // Create bars, bars contains text label on the left, rect in the middle and number labels on the right
                var bar = hispanicchart.selectAll("g")
                    .data(hispanic_data)
                    .enter().append("g")
                    .attr("transform", function (d, i) {
                        return "translate(" + spaceForLabels + "," + (i * groupHeight + gapBetweenGroups * (0.5 + i)  ) + ")";
                    });

                // Create rectangles of the correct width
                bar.append("rect")
                    .attr("fill", "#1f77b4")
                    .attr("class", "bar")
                    .attr("width", hispanic_x)
                    .attr("height", barHeight - 1);

                // Add number label on the right
                bar.append("text")
                    .attr("class", "numlabel")
                    .attr("x", function (d) {
                        return hispanic_x(d) + 3;
                    })
                    .attr("y", barHeight / 2)
                    .attr("fill", "grey")
                    .attr("dy", ".35em")
                    .style("font", "10px sans-serif")
                    .text(function (d) {
                        return d + "%";
                    });

                // Draw labels
                bar.append("text")
                    .attr("class", "label")
                    .attr("x", function (d) {
                        return -10;
                    })
                    .attr("y", groupHeight / 2)
                    .attr("dy", "-.15em")
                    .style("text-anchor", "end")
                    .style("font", "14px sans-serif")
                    .text(function (d, i) {
                        return hispanic_labels[i];
                    });

                //race chart
                var race_labels = data["race"]["labels"];
                race_data = data["race"]["values"];
                var racechartHeight = barHeight * race_data.length * 2 + gapBetweenGroups * race_labels.length;
                race_x = d3.scale.linear()
                    .domain([0, d3.max(race_data)])
                    .range([0, chartWidth]);

                // Specify the chart area and dimensions
                var racechart = d3.select("#race_chart")
                    .attr("width", spaceForLabels + chartWidth + spaceForLegend)
                    .attr("height", racechartHeight);

                // Create bars, bars contains text label on the left, rect in the middle and number labels on the right
                var bar = racechart.selectAll("g")
                    .data(race_data)
                    .enter().append("g")
                    .attr("transform", function (d, i) {
                        return "translate(" + spaceForLabels + "," + (i * groupHeight + gapBetweenGroups * (0.5 + i)  ) + ")";
                    });

                // Create rectangles of the correct width
                bar.append("rect")
                    .attr("fill", "#1f77b4")
                    .attr("class", "bar")
                    .attr("width", race_x)
                    .attr("height", barHeight - 1);

                // Add number label on the right
                bar.append("text")
                    .attr("class", "numlabel")
                    .attr("x", function (d) {
                        return race_x(d) + 3;
                    })
                    .attr("y", barHeight / 2)
                    .attr("fill", "grey")
                    .attr("dy", ".35em")
                    .style("font", "10px sans-serif")
                    .text(function (d) {
                        return d + "%";
                    });

                // Draw labels
                bar.append("text")
                    .attr("class", "label")
                    .attr("x", function (d) {
                        return -10;
                    })
                    .attr("y", groupHeight / 2)
                    .attr("dy", "-.15em")
                    .style("text-anchor", "end")
                    .style("font", "14px sans-serif")
                    .text(function (d, i) {
                        return race_labels[i];
                    });
                //party chart
                var party_labels = data["party"]["labels"];
                party_data = data["party"]["values"];
                var partychartHeight = barHeight * party_data.length * 2 + gapBetweenGroups * party_labels.length;
                party_x = d3.scale.linear()
                    .domain([0, d3.max(party_data)])
                    .range([0, chartWidth]);

                // Specify the chart area and dimensions
                var partychart = d3.select("#party_chart")
                    .attr("width", spaceForLabels + chartWidth + spaceForLegend)
                    .attr("height", partychartHeight);

                // Create bars, bars contains text label on the left, rect in the middle and number labels on the right
                var bar = partychart.selectAll("g")
                    .data(party_data)
                    .enter().append("g")
                    .attr("transform", function (d, i) {
                        return "translate(" + spaceForLabels + "," + (i * groupHeight + gapBetweenGroups * (0.5 + i)  ) + ")";
                    });

                // Create rectangles of the correct width
                bar.append("rect")
                    .attr("fill", "#1f77b4")
                    .attr("class", "bar")
                    .attr("width", party_x)
                    .attr("height", barHeight - 1);

                // Add number label on the right
                bar.append("text")
                    .attr("class", "numlabel")
                    .attr("x", function (d) {
                        return party_x(d) + 3;
                    })
                    .attr("y", barHeight / 2)
                    .attr("fill", "grey")
                    .attr("dy", ".35em")
                    .style("font", "10px sans-serif")
                    .text(function (d) {
                        return d + "%";
                    });

                // Draw labels
                bar.append("text")
                    .attr("class", "label")
                    .attr("x", function (d) {
                        return -10;
                    })
                    .attr("y", groupHeight / 2)
                    .attr("dy", "-.15em")
                    .style("text-anchor", "end")
                    .style("font", "14px sans-serif")
                    .text(function (d, i) {
                        return party_labels[i];
                    });
                //income chart
                var income_labels = data["annul_family_income"]["labels"];
                income_data = data["annul_family_income"]["values"];
                var incomechartHeight = barHeight * income_data.length * 2 + gapBetweenGroups * income_labels.length;
                income_x = d3.scale.linear()
                    .domain([0, d3.max(income_data)])
                    .range([0, chartWidth]);

                // Specify the chart area and dimensions
                var incomechart = d3.select("#income_chart")
                    .attr("width", spaceForLabels + chartWidth + spaceForLegend)
                    .attr("height", incomechartHeight);

                // Create bars, bars contains text label on the left, rect in the middle and number labels on the right
                var bar = incomechart.selectAll("g")
                    .data(income_data)
                    .enter().append("g")
                    .attr("transform", function (d, i) {
                        return "translate(" + spaceForLabels + "," + (i * groupHeight + gapBetweenGroups * (0.5 + i)  ) + ")";
                    });

                // Create rectangles of the correct width
                bar.append("rect")
                    .attr("fill", "#1f77b4")
                    .attr("class", "bar")
                    .attr("width", income_x)
                    .attr("height", barHeight - 1);

                // Add number label on the right
                bar.append("text")
                    .attr("class", "numlabel")
                    .attr("x", function (d) {
                        return income_x(d) + 3;
                    })
                    .attr("y", barHeight / 2)
                    .attr("fill", "grey")
                    .attr("dy", ".35em")
                    .style("font", "10px sans-serif")
                    .text(function (d) {
                        return d + "%";
                    });

                // Draw labels
                bar.append("text")
                    .attr("class", "label")
                    .attr("x", function (d) {
                        return -10;
                    })
                    .attr("y", groupHeight / 2)
                    .attr("dy", "-.15em")
                    .style("text-anchor", "end")
                    .style("font", "14px sans-serif")
                    .text(function (d, i) {
                        return income_labels[i];
                    });
                //political_view chart
                var political_view_labels = data["political_view"]["labels"];
                political_view_data = data["political_view"]["values"];
                var political_viewchartHeight = barHeight * political_view_data.length * 2 + gapBetweenGroups * political_view_labels.length;
                political_view_x = d3.scale.linear()
                    .domain([0, d3.max(political_view_data)])
                    .range([0, chartWidth]);

                // Specify the chart area and dimensions
                var political_viewchart = d3.select("#political_view_chart")
                    .attr("width", spaceForLabels + chartWidth + spaceForLegend)
                    .attr("height", political_viewchartHeight);

                // Create bars, bars contains text label on the left, rect in the middle and number labels on the right
                var bar = political_viewchart.selectAll("g")
                    .data(political_view_data)
                    .enter().append("g")
                    .attr("transform", function (d, i) {
                        return "translate(" + spaceForLabels + "," + (i * groupHeight + gapBetweenGroups * (0.5 + i)  ) + ")";
                    });

                // Create rectangles of the correct width
                bar.append("rect")
                    .attr("fill", "#1f77b4")
                    .attr("class", "bar")
                    .attr("width", political_view_x)
                    .attr("height", barHeight - 1);

                // Add number label on the right
                bar.append("text")
                    .attr("class", "numlabel")
                    .attr("x", function (d) {
                        return political_view_x(d) + 3;
                    })
                    .attr("y", barHeight / 2)
                    .attr("fill", "grey")
                    .attr("dy", ".35em")
                    .style("font", "10px sans-serif")
                    .text(function (d) {
                        return d + "%";
                    });

                // Draw labels
                bar.append("text")
                    .attr("class", "label")
                    .attr("x", function (d) {
                        return -10;
                    })
                    .attr("y", groupHeight / 2)
                    .attr("dy", "-.15em")
                    .style("text-anchor", "end")
                    .style("font", "14px sans-serif")
                    .text(function (d, i) {
                        return political_view_labels[i];
                    });
                //result chart
                var result_labels = data["result"]["labels"];
                var result_surveydata = data["result"]["values"];

                var width = 360,
                    height = 300,
                    barWidth = 100;

                var y = d3.scale.linear()
                    .range([height, 0])
                    .domain([0, d3.max(result_surveydata)]);

                var chart = d3.select("#result_chart")
                    .attr("width", width)
                    .attr("height", height + 30)
                    .attr("transform", function (d, i) {
                        return "translate(60,0)";
                    });

                var bar = chart
                    .selectAll("g")
                    .data(result_surveydata)
                    .enter()
                    .append("g")
                    .attr("transform", function (d, i) {
                        return "translate(" + i * barWidth * 2 + ",0)";
                    })
                    .attr("height", height);

                bar.append("rect")
                    .attr("y", function (d) {
                        return y(d);
                    })
                    .attr("height", function (d) {
                        return height - y(d);
                    })
                    .attr("width", barWidth - 5)
                    .attr("fill", function (d, i) {
                        if (i == 1) return "#3989cb"; else return "#d75c5c";
                    });
                //draw percentage
                bar.append("text")
                    .attr("x", barWidth / 2)
                    .attr("y", function (d) {
                        return y(d) + 3;
                    })
                    .attr("dy", "1.5em")
                    .attr("dx", "-1.1em")
                    .text(function (d) {
                        return d + "%";
                    });
                //draw labels
                bar.append("text")
                    .attr("x", barWidth / 2)
                    .attr("y", height)
                    .attr("dy", "1.5em").attr("dx", "-1.95em")
                    .text(function (d, i) {
                        return result_labels[i];
                    });
            });
        });
    });

    //draw baseline data
    $(document).ready(function () {
        $(".baseline_datasource").click(function () {
            $.post('/requestdata', {name: $(this).attr('value')}, function (data) {
                // Draw legend
//                var legendRectSize = 18,
//                    legendSpacing = 4;
//
//                var legend = d3.select("#edu_level_chart").selectAll('.legend')
//                    .data(edu_data)
//                    .enter()
//                    .append('g')
//                    .attr('transform', function (d, i) {
//                        var height = legendRectSize + legendSpacing;
//                        var offset = -gapBetweenGroups / 2;
//                        var horz = spaceForLabels + chartWidth + 40 - legendRectSize;
//                        var vert = i * height - offset;
//                        return 'translate(' + horz + ',' + vert + ')';
//                    });
//
//                legend.append('rect')
//                    .attr('width', legendRectSize)
//                    .attr('height', legendRectSize)
//                    .style('fill', function (d, i) {
//                        return color(i);
//                    })
//                    .style('stroke', function (d, i) {
//                        return color(i);
//                    });
//
//                legend.append('text')
//                    .attr('class', 'legend')
//                    .attr('x', legendRectSize + legendSpacing)
//                    .attr('y', legendRectSize - legendSpacing)
//                    .text(function (d) {
//                        if (d == 0) return "Current"; else return "Baseline";
//                    });

                //draw baseline data of edu chart

                //update array
                for (i = 0; i < data["last_grade_in_school"]["values"].length; i++) {
                    edu_data.push(data["last_grade_in_school"]["values"][i]);
                }
                //re-compute edu scale
                edu_x = d3.scale.linear()
                    .domain([0, d3.max(edu_data)])
                    .range([0, chartWidth]);
                //get update selection
                var edu_update = d3.select("#edu_level_chart").selectAll("g").data(edu_data);
                //re-size old rects
                edu_update.selectAll("rect")
                    .attr("width", function (d) {
                        return edu_x(d)
                    })
                    .attr("height", barHeight - 1);
                //change position of old number labels
                edu_update.selectAll(".numlabel").attr("x", function (d) {
                    return edu_x(d) + 3;
                });
                //get enter selection
                var edu_enter = edu_update.enter().append("g")
                    .attr("transform", function (d, i) {
                        return "translate(" + spaceForLabels + "," + (groupHeight * (i - edu_data.length / 2) + barHeight + gapBetweenGroups * (0.5 + (i - edu_data.length / 2)) ) + ")";
                    });
                //create rects for new data
                edu_enter.append("rect")
                    .attr("fill", function (d, i) {
                        return "#aec7e8";
                    })
                    .attr("class", "bar")
                    .attr("width", edu_x)
                    .attr("height", barHeight - 1);

                edu_enter.append("text")
                    .attr("x", function (d) {
                        return edu_x(d) + 3;
                    })
                    .attr("y", barHeight / 2)
                    .attr("fill", "grey")
                    .attr("dy", ".35em")
                    .style("font", "10px sans-serif")
                    .text(function (d) {
                        return d + "%";
                    });

                                //draw baseline data of gender chart

                //update array
                for (i = 0; i < data["gender"]["values"].length; i++) {
                    gender_data.push(data["gender"]["values"][i]);
                }
                //re-compute gender scale
                gender_x = d3.scale.linear()
                    .domain([0, d3.max(gender_data)])
                    .range([0, chartWidth]);
                //get update selection
                var gender_update = d3.select("#gender_chart").selectAll("g").data(gender_data);
                //re-size old rects
                gender_update.selectAll("rect")
                    .attr("width", function (d) {
                        return gender_x(d)
                    })
                    .attr("height", barHeight - 1);
                //change position of old number labels
                gender_update.selectAll(".numlabel").attr("x", function (d) {
                    return gender_x(d) + 3;
                });
                //get enter selection
                var gender_enter = gender_update.enter().append("g")
                    .attr("transform", function (d, i) {
                        return "translate(" + spaceForLabels + "," + (groupHeight * (i - gender_data.length / 2) + barHeight + gapBetweenGroups * (0.5 + (i - gender_data.length / 2)) ) + ")";
                    });
                //create rects for new data
                gender_enter.append("rect")
                    .attr("fill", function (d, i) {
                        return "#aec7e8";
                    })
                    .attr("class", "bar")
                    .attr("width", gender_x)
                    .attr("height", barHeight - 1);

                gender_enter.append("text")
                    .attr("x", function (d) {
                        return gender_x(d) + 3;
                    })
                    .attr("y", barHeight / 2)
                    .attr("fill", "grey")
                    .attr("dy", ".35em")
                    .style("font", "10px sans-serif")
                    .text(function (d) {
                        return d + "%";
                    });

                                //draw baseline data of hispanic chart

                //update array
                for (i = 0; i < data["hispanic_origin"]["values"].length; i++) {
                    hispanic_data.push(data["hispanic_origin"]["values"][i]);
                }
                //re-compute hispanic scale
                hispanic_x = d3.scale.linear()
                    .domain([0, d3.max(hispanic_data)])
                    .range([0, chartWidth]);
                //get update selection
                var hispanic_update = d3.select("#hispanic_chart").selectAll("g").data(hispanic_data);
                //re-size old rects
                hispanic_update.selectAll("rect")
                    .attr("width", function (d) {
                        return hispanic_x(d)
                    })
                    .attr("height", barHeight - 1);
                //change position of old number labels
                hispanic_update.selectAll(".numlabel").attr("x", function (d) {
                    return hispanic_x(d) + 3;
                });
                //get enter selection
                var hispanic_enter = hispanic_update.enter().append("g")
                    .attr("transform", function (d, i) {
                        return "translate(" + spaceForLabels + "," + (groupHeight * (i - hispanic_data.length / 2) + barHeight + gapBetweenGroups * (0.5 + (i - hispanic_data.length / 2)) ) + ")";
                    });
                //create rects for new data
                hispanic_enter.append("rect")
                    .attr("fill", function (d, i) {
                        return "#aec7e8";
                    })
                    .attr("class", "bar")
                    .attr("width", hispanic_x)
                    .attr("height", barHeight - 1);

                hispanic_enter.append("text")
                    .attr("x", function (d) {
                        return hispanic_x(d) + 3;
                    })
                    .attr("y", barHeight / 2)
                    .attr("fill", "grey")
                    .attr("dy", ".35em")
                    .style("font", "10px sans-serif")
                    .text(function (d) {
                        return d + "%";
                    });

                                //draw baseline data of race chart

                //update array
                for (i = 0; i < data["race"]["values"].length; i++) {
                    race_data.push(data["race"]["values"][i]);
                }
                //re-compute race scale
                race_x = d3.scale.linear()
                    .domain([0, d3.max(race_data)])
                    .range([0, chartWidth]);
                //get update selection
                var race_update = d3.select("#race_chart").selectAll("g").data(race_data);
                //re-size old rects
                race_update.selectAll("rect")
                    .attr("width", function (d) {
                        return race_x(d)
                    })
                    .attr("height", barHeight - 1);
                //change position of old number labels
                race_update.selectAll(".numlabel").attr("x", function (d) {
                    return race_x(d) + 3;
                });
                //get enter selection
                var race_enter = race_update.enter().append("g")
                    .attr("transform", function (d, i) {
                        return "translate(" + spaceForLabels + "," + (groupHeight * (i - race_data.length / 2) + barHeight + gapBetweenGroups * (0.5 + (i - race_data.length / 2)) ) + ")";
                    });
                //create rects for new data
                race_enter.append("rect")
                    .attr("fill", function (d, i) {
                        return "#aec7e8";
                    })
                    .attr("class", "bar")
                    .attr("width", race_x)
                    .attr("height", barHeight - 1);

                race_enter.append("text")
                    .attr("x", function (d) {
                        return race_x(d) + 3;
                    })
                    .attr("y", barHeight / 2)
                    .attr("fill", "grey")
                    .attr("dy", ".35em")
                    .style("font", "10px sans-serif")
                    .text(function (d) {
                        return d + "%";
                    });

                                //draw baseline data of party chart

                //update array
                for (i = 0; i < data["party"]["values"].length; i++) {
                    party_data.push(data["party"]["values"][i]);
                }
                //re-compute party scale
                party_x = d3.scale.linear()
                    .domain([0, d3.max(party_data)])
                    .range([0, chartWidth]);
                //get update selection
                var party_update = d3.select("#party_chart").selectAll("g").data(party_data);
                //re-size old rects
                party_update.selectAll("rect")
                    .attr("width", function (d) {
                        return party_x(d)
                    })
                    .attr("height", barHeight - 1);
                //change position of old number labels
                party_update.selectAll(".numlabel").attr("x", function (d) {
                    return party_x(d) + 3;
                });
                //get enter selection
                var party_enter = party_update.enter().append("g")
                    .attr("transform", function (d, i) {
                        return "translate(" + spaceForLabels + "," + (groupHeight * (i - party_data.length / 2) + barHeight + gapBetweenGroups * (0.5 + (i - party_data.length / 2)) ) + ")";
                    });
                //create rects for new data
                party_enter.append("rect")
                    .attr("fill", function (d, i) {
                        return "#aec7e8";
                    })
                    .attr("class", "bar")
                    .attr("width", party_x)
                    .attr("height", barHeight - 1);

                party_enter.append("text")
                    .attr("x", function (d) {
                        return party_x(d) + 3;
                    })
                    .attr("y", barHeight / 2)
                    .attr("fill", "grey")
                    .attr("dy", ".35em")
                    .style("font", "10px sans-serif")
                    .text(function (d) {
                        return d + "%";
                    });

                                //draw baseline data of income chart

                //update array
                for (i = 0; i < data["annul_family_income"]["values"].length; i++) {
                    income_data.push(data["annul_family_income"]["values"][i]);
                }
                //re-compute income scale
                income_x = d3.scale.linear()
                    .domain([0, d3.max(income_data)])
                    .range([0, chartWidth]);
                //get update selection
                var income_update = d3.select("#income_chart").selectAll("g").data(income_data);
                //re-size old rects
                income_update.selectAll("rect")
                    .attr("width", function (d) {
                        return income_x(d)
                    })
                    .attr("height", barHeight - 1);
                //change position of old number labels
                income_update.selectAll(".numlabel").attr("x", function (d) {
                    return income_x(d) + 3;
                });
                //get enter selection
                var income_enter = income_update.enter().append("g")
                    .attr("transform", function (d, i) {
                        return "translate(" + spaceForLabels + "," + (groupHeight * (i - income_data.length / 2) + barHeight + gapBetweenGroups * (0.5 + (i - income_data.length / 2)) ) + ")";
                    });
                //create rects for new data
                income_enter.append("rect")
                    .attr("fill", function (d, i) {
                        return "#aec7e8";
                    })
                    .attr("class", "bar")
                    .attr("width", income_x)
                    .attr("height", barHeight - 1);

                income_enter.append("text")
                    .attr("x", function (d) {
                        return income_x(d) + 3;
                    })
                    .attr("y", barHeight / 2)
                    .attr("fill", "grey")
                    .attr("dy", ".35em")
                    .style("font", "10px sans-serif")
                    .text(function (d) {
                        return d + "%";
                    });

                                //draw baseline data of political_view chart

                //update array
                for (i = 0; i < data["political_view"]["values"].length; i++) {
                    political_view_data.push(data["political_view"]["values"][i]);
                }
                //re-compute political_view scale
                political_view_x = d3.scale.linear()
                    .domain([0, d3.max(political_view_data)])
                    .range([0, chartWidth]);
                //get update selection
                var political_view_update = d3.select("#political_view_chart").selectAll("g").data(political_view_data);
                //re-size old rects
                political_view_update.selectAll("rect")
                    .attr("width", function (d) {
                        return political_view_x(d)
                    })
                    .attr("height", barHeight - 1);
                //change position of old number labels
                political_view_update.selectAll(".numlabel").attr("x", function (d) {
                    return political_view_x(d) + 3;
                });
                //get enter selection
                var political_view_enter = political_view_update.enter().append("g")
                    .attr("transform", function (d, i) {
                        return "translate(" + spaceForLabels + "," + (groupHeight * (i - political_view_data.length / 2) + barHeight + gapBetweenGroups * (0.5 + (i - political_view_data.length / 2)) ) + ")";
                    });
                //create rects for new data
                political_view_enter.append("rect")
                    .attr("fill", function (d, i) {
                        return "#aec7e8";
                    })
                    .attr("class", "bar")
                    .attr("width", political_view_x)
                    .attr("height", barHeight - 1);

                political_view_enter.append("text")
                    .attr("x", function (d) {
                        return political_view_x(d) + 3;
                    })
                    .attr("y", barHeight / 2)
                    .attr("fill", "grey")
                    .attr("dy", ".35em")
                    .style("font", "10px sans-serif")
                    .text(function (d) {
                        return d + "%";
                    });








            });
        });
    });


    //    <!--//gender-->
    <!--var genderdata = {-->
    <!--labels: [-->
    <!--'Male', 'Female'-->
    <!--],-->
    <!--series: [-->
    <!--{-->
    <!--label: 'current',-->
    <!--values: [47, 53]-->
    <!--},-->
    <!--{-->
    <!--label: 'All Adults',-->
    <!--values: [49, 51]-->
    <!--}]-->

    <!--};-->
    //
    //    <!--// Zip the series data together (first values, second values, etc.)-->
    //
    <!--var genderzippedData = [];-->
    //
    <!--for (var i=0; i<genderdata.labels.length; i++) {-->
    //
    <!--for (var j=0; j<genderdata.series.length; j++) {-->
    //
    <!--genderzippedData.push(genderdata.series[j].values[i]);-->
    //
    <!--}-->
    //
    <!--}-->
    //
    //    <!--// Color scale-->
    <!--var chartHeight = barHeight * genderzippedData.length + gapBetweenGroups * genderdata.labels.length;-->

    <!--var x = d3.scale.linear()-->
    <!--.domain([0, d3.max(genderzippedData)])-->
    <!--.range([0, chartWidth]);-->

    //    <!--// Specify the chart area and dimensions-->
    //
    <!--var genderchart = d3.select("#gender_chart")-->
    //
    <!--.attr("width", spaceForLabels + chartWidth + spaceForLegend)-->
    //
    <!--.attr("height", chartHeight);-->
    //
    //    <!--// Create bars-->
    //
    <!--var bar = genderchart.selectAll("g")-->
    //
    <!--.data(genderzippedData)-->
    //
    <!--.enter().append("g")-->
    //
    <!--.attr("transform", function(d, i) {-->
    //
    <!--return "translate(" + spaceForLabels + "," + (i * barHeight + gapBetweenGroups * (0.5 + Math.floor(i/genderdata.series.length))) + ")";-->
    //
    <!--});-->
    //
    //    <!--// Create rectangles of the correct width-->
    //
    <!--bar.append("rect")-->
    //
    <!--.attr("fill", function(d,i) { return color(i % genderdata.series.length); })-->
    //
    <!--.attr("class", "bar")-->
    //
    <!--.attr("width", x)-->
    //
    <!--.attr("height", barHeight - 1);-->
    //
    //    <!--// Add text label in bar-->
    //
    <!--bar.append("text")-->
    //
    <!--.attr("x", function(d) { return x(d) + 3; })-->
    //
    //
    <!--.attr("y", barHeight / 2)-->
    //
    <!--.attr("fill", "grey")-->
    //
    <!--.attr("dy", ".35em")-->
    //
    <!--.style("font","10px sans-serif")-->
    //
    <!--.text(function(d) { return d+"%"; });-->
    //
    //    <!--// Draw labels-->
    //
    <!--bar.append("text")-->
    //
    <!--.attr("class", "label")-->
    //
    <!--.attr("x", function(d) { return - 10; })-->
    //
    <!--.attr("y", groupHeight / 2)-->
    //
    <!--.attr("dy", ".35em")-->
    //
    <!--.style("text-anchor","end")-->
    //
    <!--.style("font","14px sans-serif")-->
    //
    <!--.text(function(d,i) {-->
    //
    <!--if (i % genderdata.series.length === 0)-->
    //
    <!--return genderdata.labels[Math.floor(i/genderdata.series.length)];-->
    //
    <!--else-->
    //
    <!--return ""});-->
    //
    //    <!--// genderchart.append("g")-->
    //    <!--//       .attr("class", "y axis")-->
    //    <!--//       .attr("transform", "translate(" + spaceForLabels + ", " + -gapBetweenGroups/2 + ")")-->
    //    <!--//       .call(yAxis);-->
    //
    //    <!--//hispanic-->
    //
    <!--var hispanicdata = {-->
    //
    <!--labels: [-->
    //
    <!--'Hispanic origin', 'Non-Hispanic origin'-->
    //
    <!--],-->
    //
    <!--series: [-->
    //
    <!--{-->
    //
    <!--label: 'current',-->
    //
    <!--values: [8, 92]-->
    //
    <!--},-->
    //
    <!--{-->
    //
    <!--label: 'All Adults',-->
    //
    <!--values: [17, 83]-->
    //
    <!--}]-->
    //
    //
    <!--};-->
    //
    //    <!--// Zip the series data together (first values, second values, etc.)-->
    //
    <!--var hispaniczippedData = [];-->
    //
    <!--for (var i=0; i<hispanicdata.labels.length; i++) {-->
    //
    <!--for (var j=0; j<hispanicdata.series.length; j++) {-->
    //
    <!--hispaniczippedData.push(hispanicdata.series[j].values[i]);-->
    //
    <!--}-->
    //
    <!--}-->
    //
    //    <!--// Color scale-->
    //
    <!--var chartHeight = barHeight * hispaniczippedData.length + gapBetweenGroups * hispanicdata.labels.length;-->
    //
    //
    <!--var x = d3.scale.linear()-->
    //
    <!--.domain([0, d3.max(hispaniczippedData)])-->
    //
    <!--.range([0, chartWidth]);-->
    //
    //    <!--// Specify the chart area and dimensions-->
    //
    <!--var hispanicchart = d3.select("#hispanic_chart")-->
    //
    <!--.attr("width", spaceForLabels + chartWidth + spaceForLegend)-->
    //
    <!--.attr("height", chartHeight);-->
    //
    //    <!--// Create bars-->
    //
    <!--var bar = hispanicchart.selectAll("g")-->
    //
    <!--.data(hispaniczippedData)-->
    //
    <!--.enter().append("g")-->
    //
    <!--.attr("transform", function(d, i) {-->
    //
    <!--return "translate(" + spaceForLabels + "," + (i * barHeight + gapBetweenGroups * (0.5 + Math.floor(i/hispanicdata.series.length))) + ")";-->
    //
    <!--});-->
    //
    //    <!--// Create rectangles of the correct width-->
    //
    <!--bar.append("rect")-->
    //
    <!--.attr("fill", function(d,i) { return color(i % hispanicdata.series.length); })-->
    //
    <!--.attr("class", "bar")-->
    //
    <!--.attr("width", x)-->
    //
    <!--.attr("height", barHeight - 1);-->
    //
    //    <!--// Add text label in bar-->
    //
    <!--bar.append("text")-->
    //
    <!--.attr("x", function(d) { return x(d) + 3; })-->
    //
    <!--.attr("y", barHeight / 2)-->
    //
    <!--.attr("fill", "grey")-->
    //
    <!--.attr("dy", ".35em")-->
    //
    <!--.style("font","10px sans-serif")-->
    //
    <!--.text(function(d) { return d+"%"; });-->
    //
    //    <!--// Draw labels-->
    //
    <!--bar.append("text")-->
    //
    <!--.attr("class", "label")-->
    //
    <!--.attr("x", function(d) { return - 10; })-->
    //
    <!--.attr("y", groupHeight / 2)-->
    //
    <!--.attr("dy", ".35em")-->
    //
    <!--.style("text-anchor","end")-->
    //
    <!--.style("font","14px sans-serif")-->
    //
    <!--.text(function(d,i) {-->
    //
    <!--if (i % hispanicdata.series.length === 0)-->
    //
    <!--return hispanicdata.labels[Math.floor(i/hispanicdata.series.length)];-->
    //
    <!--else-->
    //
    <!--return ""});-->
    //    <!--//race-->
    //
    <!--var racedata = {-->
    //
    <!--labels: [-->
    //
    <!--'White', 'Black','Asian'-->
    //
    <!--],-->
    //
    <!--series: [-->
    //
    <!--{-->
    //
    <!--label: 'current',-->
    //
    <!--values: [85,12, 3]-->
    //
    <!--},-->
    //
    <!--{-->
    //
    <!--label: 'All Adults',-->
    //
    <!--values: [80, 14,6]-->
    //
    <!--}]-->
    //
    //
    <!--};-->
    //
    //    <!--// Zip the series data together (first values, second values, etc.)-->
    //
    <!--var racezippedData = [];-->
    //
    <!--for (var i=0; i<racedata.labels.length; i++) {-->
    //
    <!--for (var j=0; j<racedata.series.length; j++) {-->
    //
    <!--racezippedData.push(racedata.series[j].values[i]);-->
    //
    <!--}-->
    //
    <!--}-->
    //
    //    <!--// Color scale-->
    //
    <!--var chartHeight = barHeight * racezippedData.length + gapBetweenGroups * racedata.labels.length;-->
    //
    //
    <!--var x = d3.scale.linear()-->
    //
    <!--.domain([0, d3.max(racezippedData)])-->
    //
    <!--.range([0, chartWidth]);-->
    //
    //    <!--// Specify the chart area and dimensions-->
    //
    <!--var racechart = d3.select("#race_chart")-->
    //
    <!--.attr("width", spaceForLabels + chartWidth + spaceForLegend)-->
    //
    <!--.attr("height", chartHeight);-->
    //
    //    <!--// Create bars-->
    //
    <!--var bar = racechart.selectAll("g")-->
    //
    <!--.data(racezippedData)-->
    //
    <!--.enter().append("g")-->
    //
    <!--.attr("transform", function(d, i) {-->
    //
    <!--return "translate(" + spaceForLabels + "," + (i * barHeight + gapBetweenGroups * (0.5 + Math.floor(i/racedata.series.length))) + ")";-->
    //
    <!--});-->
    //
    //    <!--// Create rectangles of the correct width-->
    //
    <!--bar.append("rect")-->
    //
    <!--.attr("fill", function(d,i) { return color(i % racedata.series.length); })-->
    //
    <!--.attr("class", "bar")-->
    //
    <!--.attr("width", x)-->
    //
    <!--.attr("height", barHeight - 1);-->
    //
    //    <!--// Add text label in bar-->
    //
    <!--bar.append("text")-->
    //
    <!--.attr("x", function(d) {return x(d) + 3; })-->
    //
    <!--.attr("y", barHeight / 2)-->
    //
    <!--.attr("fill", "grey")-->
    //
    <!--.attr("dy", ".35em")-->
    //
    <!--.style("font","10px sans-serif")-->
    //
    <!--.text(function(d) { return d+"%"; });-->
    //
    //    <!--// Draw labels-->
    //
    <!--bar.append("text")-->
    //
    <!--.attr("class", "label")-->
    //
    <!--.attr("x", function(d) { return - 10; })-->
    //
    <!--.attr("y", groupHeight / 2)-->
    //
    <!--.attr("dy", ".35em")-->
    //
    <!--.style("text-anchor","end")-->
    //
    <!--.style("font","14px sans-serif")-->
    //
    <!--.text(function(d,i) {-->
    //
    <!--if (i % racedata.series.length === 0)-->
    //
    <!--return racedata.labels[Math.floor(i/racedata.series.length)];-->
    //
    <!--else-->
    //
    <!--return ""});-->
    //    <!--//party-->
    //
    <!--var partydata = {-->
    //
    <!--labels: [-->
    //
    <!--'Republican', 'Democrat','Independent','Something Else'-->
    //
    <!--],-->
    //
    <!--series: [-->
    //
    <!--{-->
    //
    <!--label: 'current',-->
    //
    <!--values: [27, 34,30,9]-->
    //
    <!--},-->
    //
    <!--{-->
    //
    <!--label: 'All Adults',-->
    //
    <!--values: [28, 38,32,2]-->
    //
    <!--}]-->
    //
    //
    <!--};-->
    //
    //    <!--// Zip the series data together (first values, second values, etc.)-->
    //
    <!--var partyzippedData = [];-->
    //
    <!--for (var i=0; i<partydata.labels.length; i++) {-->
    //
    <!--for (var j=0; j<partydata.series.length; j++) {-->
    //
    <!--partyzippedData.push(partydata.series[j].values[i]);-->
    //
    <!--}-->
    //
    <!--}-->
    //
    //    <!--// Color scale-->
    //
    <!--var chartHeight = barHeight * partyzippedData.length + gapBetweenGroups * partydata.labels.length;-->
    //
    //
    <!--var x = d3.scale.linear()-->
    //
    <!--.domain([0, d3.max(partyzippedData)])-->
    //
    <!--.range([0, chartWidth]);-->
    //
    //    <!--// Specify the chart area and dimensions-->
    //
    <!--var partychart = d3.select("#party_chart")-->
    //
    <!--.attr("width", spaceForLabels + chartWidth + spaceForLegend)-->
    //
    <!--.attr("height", chartHeight);-->
    //
    //    <!--// Create bars-->
    //
    <!--var bar = partychart.selectAll("g")-->
    //
    <!--.data(partyzippedData)-->
    //
    <!--.enter().append("g")-->
    //
    <!--.attr("transform", function(d, i) {-->
    //
    <!--return "translate(" + spaceForLabels + "," + (i * barHeight + gapBetweenGroups * (0.5 + Math.floor(i/partydata.series.length))) + ")";-->
    //
    <!--});-->
    //
    //    <!--// Create rectangles of the correct width-->
    //
    <!--bar.append("rect")-->
    //
    <!--.attr("fill", function(d,i) { return color(i % partydata.series.length); })-->
    //
    <!--.attr("class", "bar")-->
    //
    <!--.attr("width", x)-->
    //
    <!--.attr("height", barHeight - 1);-->
    //
    //    <!--// Add text label in bar-->
    //
    <!--bar.append("text")-->
    //
    <!--.attr("x", function(d) { return x(d) + 3; })-->
    //
    <!--.attr("y", barHeight / 2)-->
    //
    <!--.attr("fill", "grey")-->
    //
    <!--.attr("dy", ".35em")-->
    //
    <!--.style("font","10px sans-serif")-->
    //
    <!--.text(function(d) { return d+"%"; });-->
    //
    //    <!--// Draw labels-->
    //
    <!--bar.append("text")-->
    //
    <!--.attr("class", "label")-->
    //
    <!--.attr("x", function(d) { return - 10; })-->
    //
    <!--.attr("y", groupHeight / 2)-->
    //
    <!--.attr("dy", ".35em")-->
    //
    <!--.style("text-anchor","end")-->
    //
    <!--.style("font","14px sans-serif")-->
    //
    <!--.text(function(d,i) {-->
    //
    <!--if (i % partydata.series.length === 0)-->
    //
    <!--return partydata.labels[Math.floor(i/partydata.series.length)];-->
    //
    <!--else-->
    //
    <!--return ""});-->
    //    <!--//income-->
    //
    <!--var incomedata = {-->
    //
    <!--labels: [-->
    //
    <!--'Under $25,000', '$25,000 to $50,000','$50,000 to $100,000','$100,000 or more'-->
    //
    <!--],-->
    //
    <!--series: [-->
    //
    <!--{-->
    //
    <!--label: 'current',-->
    //
    <!--values: [8, 19,30,32]-->
    //
    <!--},-->
    //
    <!--{-->
    //
    <!--label: 'All Adults',-->
    //
    <!--values: [17, 23,32,28]-->
    //
    <!--}]-->
    //
    //
    <!--};-->
    //
    //    <!--// Zip the series data together (first values, second values, etc.)-->
    //
    <!--var incomezippedData = [];-->
    //
    <!--for (var i=0; i<incomedata.labels.length; i++) {-->
    //
    <!--for (var j=0; j<incomedata.series.length; j++) {-->
    //
    <!--incomezippedData.push(incomedata.series[j].values[i]);-->
    //
    <!--}-->
    //
    <!--}-->
    //
    //    <!--// Color scale-->
    //
    <!--var chartHeight = barHeight * incomezippedData.length + gapBetweenGroups * incomedata.labels.length;-->
    //
    //
    <!--var x = d3.scale.linear()-->
    //
    <!--.domain([0, d3.max(incomezippedData)])-->
    //
    <!--.range([0, chartWidth]);-->
    //
    //    <!--// Specify the chart area and dimensions-->
    //
    <!--var incomechart = d3.select("#income_chart")-->
    //
    <!--.attr("width", spaceForLabels + chartWidth + spaceForLegend)-->
    //
    <!--.attr("height", chartHeight);-->
    //
    //    <!--// Create bars-->
    //
    <!--var bar = incomechart.selectAll("g")-->
    //
    <!--.data(incomezippedData)-->
    //
    <!--.enter().append("g")-->
    //
    <!--.attr("transform", function(d, i) {-->
    //
    <!--return "translate(" + spaceForLabels + "," + (i * barHeight + gapBetweenGroups * (0.5 + Math.floor(i/incomedata.series.length))) + ")";-->
    //
    <!--});-->
    //
    //    <!--// Create rectangles of the correct width-->
    //
    <!--bar.append("rect")-->
    //
    <!--.attr("fill", function(d,i) { return color(i % incomedata.series.length); })-->
    //
    <!--.attr("class", "bar")-->
    //
    <!--.attr("width", x)-->
    //
    <!--.attr("height", barHeight - 1);-->
    //
    //    <!--// Add text label in bar-->
    //
    <!--bar.append("text")-->
    //
    <!--.attr("x", function(d) { return x(d) + 3; })-->
    //
    <!--.attr("y", barHeight / 2)-->
    //
    <!--.attr("fill", "grey")-->
    //
    <!--.attr("dy", ".35em")-->
    //
    <!--.style("font","10px sans-serif")-->
    //
    <!--.text(function(d) { return d+"%"; });-->
    //
    //    <!--// Draw labels-->
    //
    <!--bar.append("text")-->
    //
    <!--.attr("class", "label")-->
    //
    <!--.attr("x", function(d) { return - 10; })-->
    //
    <!--.attr("y", groupHeight / 2)-->
    //
    <!--.attr("dy", ".35em")-->
    //
    <!--.style("text-anchor","end")-->
    //
    <!--.style("font","14px sans-serif")-->
    //
    <!--.text(function(d,i) {-->
    //
    <!--if (i % incomedata.series.length === 0)-->
    //
    <!--return incomedata.labels[Math.floor(i/incomedata.series.length)];-->
    //
    <!--else-->
    //
    <!--return ""});-->
    //    <!--//political_view-->
    //
    <!--var political_viewdata = {-->
    //
    <!--labels: [-->
    //
    <!--'Liberal', 'Moderate','Conservative'-->
    //
    <!--],-->
    //
    <!--series: [-->
    //
    <!--{-->
    //
    <!--label: 'current',-->
    //
    <!--values: [27,40,33]-->
    //
    <!--},-->
    //
    <!--{-->
    //
    <!--label: 'All Adults',-->
    //
    <!--values: [25, 40,35]-->
    //
    <!--}]-->
    //
    //
    <!--};-->
    //
    //    <!--// Zip the series data together (first values, second values, etc.)-->
    //
    <!--var political_viewzippedData = [];-->
    //
    <!--for (var i=0; i<political_viewdata.labels.length; i++) {-->
    //
    <!--for (var j=0; j<political_viewdata.series.length; j++) {-->
    //
    <!--political_viewzippedData.push(political_viewdata.series[j].values[i]);-->
    //
    <!--}-->
    //
    <!--}-->
    //
    //    <!--// Color scale-->
    //
    <!--var chartHeight = barHeight * political_viewzippedData.length + gapBetweenGroups * political_viewdata.labels.length;-->
    //
    //
    <!--var x = d3.scale.linear()-->
    //
    <!--.domain([0, d3.max(political_viewzippedData)])-->
    //
    <!--.range([0, chartWidth]);-->
    //
    //    <!--// Specify the chart area and dimensions-->
    //
    <!--var political_viewchart = d3.select("#political_view_chart")-->
    //
    <!--.attr("width", spaceForLabels + chartWidth + spaceForLegend)-->
    //
    <!--.attr("height", chartHeight);-->
    //
    //    <!--// Create bars-->
    //
    <!--var bar = political_viewchart.selectAll("g")-->
    //
    <!--.data(political_viewzippedData)-->
    //
    <!--.enter().append("g")-->
    //
    <!--.attr("transform", function(d, i) {-->
    //
    <!--return "translate(" + spaceForLabels + "," + (i * barHeight + gapBetweenGroups * (0.5 + Math.floor(i/political_viewdata.series.length))) + ")";-->
    //
    <!--});-->
    //
    //    <!--// Create rectangles of the correct width-->
    //
    <!--bar.append("rect")-->
    //
    <!--.attr("fill", function(d,i) { return color(i % political_viewdata.series.length); })-->
    //
    <!--.attr("class", "bar")-->
    //
    <!--.attr("width", x)-->
    //
    <!--.attr("height", barHeight - 1);-->
    //
    //    <!--// Add text label in bar-->
    //
    <!--bar.append("text")-->
    //
    <!--.attr("x", function(d) { return x(d) + 3; })-->
    //
    <!--.attr("y", barHeight / 2)-->
    //
    <!--.attr("fill", "grey")-->
    //
    <!--.attr("dy", ".35em")-->
    //
    <!--.style("font","10px sans-serif")-->
    //
    <!--.text(function(d) { return d+"%"; });-->
    //
    //    <!--// Draw labels-->
    //
    <!--bar.append("text")-->
    //
    <!--.attr("class", "label")-->
    //
    <!--.attr("x", function(d) { return - 10; })-->
    //
    <!--.attr("y", groupHeight / 2)-->
    //
    <!--.attr("dy", ".35em")-->
    //
    <!--.style("text-anchor","end")-->
    //
    <!--.style("font","14px sans-serif")-->
    //
    <!--.text(function(d,i) {-->
    //
    <!--if (i % political_viewdata.series.length === 0)-->
    //
    <!--return political_viewdata.labels[Math.floor(i/political_viewdata.series.length)];-->
    //
    <!--else-->
    //
    <!--return ""});-->


</script>

</body>